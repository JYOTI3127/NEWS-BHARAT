{% extends "admin/base_site.html" %}
{% load i18n static %}

{% block title %}News Dashboard | Admin{% endblock %}
{% block content_title %}Dashboard{% endblock %}
{% block nav_overview_active %}active{% endblock %}

{% block extrastyle %}
<link rel="stylesheet" href="{% static 'admin/css/custom_admin.css' %}">
<link rel="stylesheet" href="{% static 'admin/css/dashboard.css' %}">
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js" defer></script>
{% endblock %}

{% block content %}

{% if stats_error %}
<div class="db-error-banner">
  <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
    <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
    <line x1="12" y1="8" x2="12" y2="12" stroke="currentColor" stroke-width="2"/>
    <line x1="12" y1="16" x2="12.01" y2="16" stroke="currentColor" stroke-width="2"/>
  </svg>
  <span>Stats unavailable: {{ stats_error }}</span>
</div>
{% endif %}

<!-- DATE STRIP -->
<div class="dash-subtitle">
  <svg class="dash-subtitle__icon" width="14" height="14" viewBox="0 0 24 24" fill="none">
    <rect x="3" y="4" width="18" height="18" rx="2" stroke="currentColor" stroke-width="2"/>
    <line x1="16" y1="2" x2="16" y2="6" stroke="currentColor" stroke-width="2"/>
    <line x1="8" y1="2" x2="8" y2="6" stroke="currentColor" stroke-width="2"/>
    <line x1="3" y1="10" x2="21" y2="10" stroke="currentColor" stroke-width="2"/>
  </svg>
  <span id="currentDateRange">Loading&#8230;</span>
  <span class="dash-subtitle__sep">&middot;</span>
  <span>Live newsroom data</span>
</div>

<!-- ══════════════════════════════════════════
     ROW 1 — KPI CARDS
══════════════════════════════════════════ -->
<div class="kpi-row">

  <!-- Highlight card -->
  <div class="kpi-card kpi-card--highlight">
    <div class="kpi-update-dot"></div>
    <span class="kpi-update-label">Live</span>
    <span class="kpi-update-date" id="liveDate">&#8212;</span>
    <p class="kpi-update-text">
      <strong>{{ published_this_week }}</strong> articles published this week.
      <strong>{{ overdue_articles }}</strong> deadline{% if overdue_articles != 1 %}s{% endif %} overdue.
    </p>
    <a href="" class="kpi-see-btn">
      View Articles &#x203A;
    </a>
  </div>

  <!-- Total Articles -->
  <div class="kpi-card">
    <div class="kpi-card-header">
      <span class="kpi-label">Total Articles</span>
      <a href="" class="kpi-more-link" title="View all">&#x203A;</a>
    </div>
    <div class="kpi-value" id="totalArticles">
       {{ published_articles }}
    </div>
    <div class="kpi-trend">
      <span class="trend-up">&#x2191; {{ published_this_month }} published this month</span>
    </div>
  </div>

  <!-- Published -->
  <div class="kpi-card">
    <div class="kpi-card-header">
      <span class="kpi-label">Published</span>
      <a href="" class="kpi-more-link">&#x203A;</a>
    </div>
    <div class="kpi-value" id="publishedArticles">
      <div class="kpi-skeleton"></div>
    </div>
    <div class="kpi-trend">
      <span class="trend-up">&#x2191; {{ published_this_week }} this week</span>
    </div>
  </div>

  <!-- In Review / Fact Check -->
  <div class="kpi-card">
    <div class="kpi-card-header">
      <span class="kpi-label">In Pipeline</span>
      <a href="
      " class="kpi-more-link">&#x203A;</a>
    </div>
    <div class="kpi-value" id="pipelineArticles">
      <div class="kpi-skeleton"></div>
    </div>
    <div class="kpi-trend">
      <span class="trend-neutral">
        {{ review_articles }} review &middot; {{ fact_check_articles }} fact check
      </span>
    </div>
  </div>

</div>
<!-- END ROW 1 -->

<!-- ══════════════════════════════════════════
     ROW 1b — SECONDARY STAT PILLS
══════════════════════════════════════════ -->
<div class="stat-pills">
  <div class="stat-pill">
    <span class="stat-pill__icon stat-pill__icon--draft">
      <svg width="13" height="13" viewBox="0 0 24 24" fill="none">
        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" stroke="currentColor" stroke-width="2"/>
        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" stroke="currentColor" stroke-width="2"/>
      </svg>
    </span>
    <span class="stat-pill__val">{{ draft_articles }}</span>
    <span class="stat-pill__label">Drafts</span>
  </div>
  <div class="stat-pill">
    <span class="stat-pill__icon stat-pill__icon--scheduled">
      <svg width="13" height="13" viewBox="0 0 24 24" fill="none">
        <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
        <polyline points="12 6 12 12 16 14" stroke="currentColor" stroke-width="2"/>
      </svg>
    </span>
    <span class="stat-pill__val">{{ scheduled_articles }}</span>
    <span class="stat-pill__label">Scheduled</span>
  </div>
  <div class="stat-pill">
    <span class="stat-pill__icon stat-pill__icon--archived">
      <svg width="13" height="13" viewBox="0 0 24 24" fill="none">
        <polyline points="21 8 21 21 3 21 3 8" stroke="currentColor" stroke-width="2"/>
        <rect x="1" y="3" width="22" height="5" stroke="currentColor" stroke-width="2"/>
        <line x1="10" y1="12" x2="14" y2="12" stroke="currentColor" stroke-width="2"/>
      </svg>
    </span>
    <span class="stat-pill__val">{{ archived_articles }}</span>
    <span class="stat-pill__label">Archived</span>
  </div>
  <div class="stat-pill">
    <span class="stat-pill__icon stat-pill__icon--rejected">
      <svg width="13" height="13" viewBox="0 0 24 24" fill="none">
        <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
        <line x1="15" y1="9" x2="9" y2="15" stroke="currentColor" stroke-width="2"/>
        <line x1="9" y1="9" x2="15" y2="15" stroke="currentColor" stroke-width="2"/>
      </svg>
    </span>
    <span class="stat-pill__val">{{ rejected_articles }}</span>
    <span class="stat-pill__label">Rejected</span>
  </div>
  <div class="stat-pill">
    <span class="stat-pill__icon stat-pill__icon--paid">
      <svg width="13" height="13" viewBox="0 0 24 24" fill="none">
        <rect x="1" y="4" width="22" height="16" rx="2" stroke="currentColor" stroke-width="2"/>
        <line x1="1" y1="10" x2="23" y2="10" stroke="currentColor" stroke-width="2"/>
      </svg>
    </span>
    <span class="stat-pill__val">{{ paid_articles }}</span>
    <span class="stat-pill__label">Paid</span>
  </div>
  <div class="stat-pill">
    <span class="stat-pill__icon stat-pill__icon--overdue">
      <svg width="13" height="13" viewBox="0 0 24 24" fill="none">
        <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z" stroke="currentColor" stroke-width="2"/>
        <line x1="12" y1="9" x2="12" y2="13" stroke="currentColor" stroke-width="2"/>
        <line x1="12" y1="17" x2="12.01" y2="17" stroke="currentColor" stroke-width="2"/>
      </svg>
    </span>
    <span class="stat-pill__val">{{ overdue_articles }}</span>
    <span class="stat-pill__label">Overdue</span>
  </div>
  <div class="stat-pill">
    <span class="stat-pill__icon stat-pill__icon--authors">
      <svg width="13" height="13" viewBox="0 0 24 24" fill="none">
        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" stroke="currentColor" stroke-width="2"/>
        <circle cx="9" cy="7" r="4" stroke="currentColor" stroke-width="2"/>
        <path d="M23 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75" stroke="currentColor" stroke-width="2"/>
      </svg>
    </span>
    <span class="stat-pill__val">{{ total_authors }}</span>
    <span class="stat-pill__label">Authors</span>
  </div>
  <div class="stat-pill">
    <span class="stat-pill__icon stat-pill__icon--categories">
      <svg width="13" height="13" viewBox="0 0 24 24" fill="none">
        <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z" stroke="currentColor" stroke-width="2"/>
        <line x1="7" y1="7" x2="7.01" y2="7" stroke="currentColor" stroke-width="2"/>
      </svg>
    </span>
    <span class="stat-pill__val">{{ total_categories }}</span>
    <span class="stat-pill__label">Categories</span>
  </div>
</div>

<!-- ══════════════════════════════════════════
     HOMEPAGE CONTROL — HYBRID
══════════════════════════════════════════ -->
<div class="dash-card dash-card--homepage">

  <div class="dash-card-header">
    <h3 class="dash-card-title">Homepage Control</h3>
  </div>

  <div class="homepage-grid">

    {% for slot in homepage_slots %}
    <div class="homepage-slot">
      <div class="slot-header">
        <span class="slot-name">{{ slot.slot_name|title }}</span>
        <span class="slot-mode slot-mode--{{ slot.mode }}">
          {{ slot.mode|upper }}
        </span>
      </div>

      <div class="slot-body">
        {% if slot.mode == "manual" and slot.article %}
          <span class="slot-article">
            {{ slot.article.title|truncatechars:40 }}
          </span>
          {% if slot.pin_until %}
          <span class="slot-expiry">
            Pinned until {{ slot.pin_until|date:"M d, H:i" }}
          </span>
          {% endif %}
        {% else %}
          <span class="slot-auto-rule">
            Auto: {{ slot.auto_rule|default:"Latest Published" }}
          </span>
        {% endif %}
      </div>

      <div class="slot-actions">
        <a href="" class="slot-edit-btn">Edit</a>
      </div>
    </div>
    {% empty %}
      <p class="empty-table">No homepage slots configured yet.</p>
    {% endfor %}

  </div>
</div>

<br>

<!-- ══════════════════════════════════════════
     ROW 2 — RECENT ARTICLES TABLE + BAR CHART
══════════════════════════════════════════ -->
<div class="dash-mid-row">

  <!-- Recent Articles -->
  <div class="dash-card dash-card--articles">
    <div class="dash-card-header">
      <h3 class="dash-card-title">Recent Articles</h3>
      <a href="" class="dash-card-link">View all &#x203A;</a>
    </div>

    <table class="articles-table">
      <thead>
        <tr>
          <th>Title</th>
          <th>Category</th>
          <th>Author</th>
          <th>Assigned To</th>
          <th>Date</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody>
        {% if recent_articles %}
          {% for article in recent_articles %}
          <tr class="table-row-anim table-row-delay-{{ forloop.counter }}">
            <td>
              <div class="article-cell">
                <div class="article-icon">
                  <svg width="13" height="13" viewBox="0 0 24 24" fill="none">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" stroke="currentColor" stroke-width="2"/>
                    <polyline points="14 2 14 8 20 8" stroke="currentColor" stroke-width="2"/>
                  </svg>
                </div>
                <div class="article-meta">
                  <a href="" class="article-name">
                    {{ article.title|truncatechars:36 }}
                  </a>
                  {% if article.is_paid %}
                  <span class="article-paid-tag">Paid</span>
                  {% endif %}
                </div>
              </div>
            </td>
            <td>{{ article.category.name|default:"—" }}</td>
            <td>{{ article.author.get_full_name|default:article.author.username }}</td>
            <td>
              {% if article.assigned_to %}
                {{ article.assigned_to.get_full_name|default:article.assigned_to.username }}
              {% else %}
                <span class="unassigned">Unassigned</span>
              {% endif %}
            </td>
            <td class="date-cell">{{ article.created_at|date:"M d, Y" }}</td>
            <td>
              <span class="status-badge status-badge--{{ article.status }}">
                {{ article.get_status_display }}
              </span>
            </td>
          </tr>
          {% endfor %}
        {% else %}
          <tr>
            <td colspan="6" class="empty-table">
              No articles yet.
              <a href="">Create your first &#x2192;</a>
            </td>
          </tr>
        {% endif %}
      </tbody>
    </table>
  </div>

  <!-- Publications Bar Chart -->
  <div class="dash-card dash-card--chart">
    <div class="dash-card-header">
      <h3 class="dash-card-title">Publications</h3>
      <div class="chart-legend">
        <span class="legend-dot legend-dot--pub"></span>
        <span class="legend-text">Published</span>
        <span class="legend-dot legend-dot--draft"></span>
        <span class="legend-text">Drafts</span>
      </div>
    </div>
    <div class="chart-value-hero">
      <span class="chart-hero-num">{{ total_articles }}</span>
      <span class="chart-hero-trend">
        &#x2191; {{ published_this_month }} this month
      </span>
    </div>
    <div class="chart-wrap">
      <canvas id="pubChart"></canvas>
    </div>
  </div>

</div>
<!-- END ROW 2 -->

<!-- ══════════════════════════════════════════
     ROW 3 — CATEGORIES + DONUT + FACT CHECKS
══════════════════════════════════════════ -->
<div class="dash-bottom-row">

  <!-- Category bars (real data from category_stats) -->
  <div class="dash-card dash-card--categories">
    <div class="dash-card-header">
      <h3 class="dash-card-title">Articles by Category</h3>
      <a href="" class="dash-card-link">Manage &#x203A;</a>
    </div>
    <div class="category-bars">
      {% if category_stats %}
        {% for cat in category_stats %}
        <div class="cat-row">
          <span class="cat-label" title="{{ cat.name }}">{{ cat.name|truncatechars:14 }}</span>
          <div class="cat-bar-track">
            <div class="cat-bar-fill cat-bar--{% cycle 'high' 'mid' 'low' 'high' 'mid' 'low' %}"
                 data-width="{{ cat.pct }}"></div>
          </div>
          <span class="cat-count">{{ cat.article_count }}</span>
        </div>
        {% endfor %}
      {% else %}
        <p class="empty-table">No categories yet. <a href="">Add one &#x2192;</a></p>
      {% endif %}
    </div>
  </div>

  <!-- Donut — article status distribution -->
  <div class="dash-card dash-card--donut">
    <div class="dash-card-header">
      <h3 class="dash-card-title">Status Split</h3>
    </div>
    <div class="donut-wrap">
      <canvas id="donutChart" width="150" height="150"></canvas>
      <div class="donut-center">
        <span class="donut-count">{{ total_articles }}</span>
        <span class="donut-sub">Total</span>
      </div>
    </div>
    <div class="donut-legend">
      <span class="legend-item"><span class="ld ld--pub"></span> Published</span>
      <span class="legend-item"><span class="ld ld--draft"></span> Draft</span>
      <span class="legend-item"><span class="ld ld--review"></span> Review</span>
      <span class="legend-item"><span class="ld ld--archive"></span> Archived</span>
    </div>
    <p class="donut-tip">Keep the pipeline flowing — {{ review_articles }} articles awaiting review.</p>
    <a href="" class="guide-btn">Open All Articles</a>
  </div>

  <!-- Fact Check Status card -->
  <div class="dash-card dash-card--factcheck">
    <div class="dash-card-header">
      <h3 class="dash-card-title">Fact Checks</h3>
      <a href="" class="dash-card-link">View &#x203A;</a>
    </div>
    <div class="factcheck-rows">
      <div class="fc-row">
        <span class="fc-dot fc-dot--pending"></span>
        <span class="fc-label">Pending</span>
        <span class="fc-val">{{ pending_fact_checks }}</span>
      </div>
      <div class="fc-row">
        <span class="fc-dot fc-dot--verified"></span>
        <span class="fc-label">Verified</span>
        <span class="fc-val">{{ verified_fact_checks }}</span>
      </div>
      <div class="fc-row">
        <span class="fc-dot fc-dot--issues"></span>
        <span class="fc-label">Issues Found</span>
        <span class="fc-val">{{ issues_fact_checks }}</span>
      </div>
    </div>

    <div class="dash-card-divider"></div>

    <h4 class="dash-sub-heading">Top Reporters</h4>
    <div class="top-reporters">
      {% if top_reporters %}
        {% for perf in top_reporters %}
        <div class="reporter-row">
          <div class="reporter-avatar">
            {{ perf.reporter.first_name|first|upper }}{{ perf.reporter.last_name|first|upper }}
          </div>
          <div class="reporter-info">
            <span class="reporter-name">
              {{ perf.reporter.get_full_name|default:perf.reporter.username }}
            </span>
            <span class="reporter-stats">
              {{ perf.published_articles }} pub &middot; {{ perf.rejected_articles }} rej
            </span>
          </div>
          <span class="reporter-total">{{ perf.total_articles }}</span>
        </div>
        {% endfor %}
      {% else %}
        <p class="empty-table">No reporter data yet.</p>
      {% endif %}
    </div>
  </div>

</div>

<!-- ══════════════════════════════════════════
     ROW 4 — RECENT WORKFLOW LOGS
══════════════════════════════════════════ -->
<div class="dash-logs-row">
  <div class="dash-card dash-card--logs">
    <div class="dash-card-header">
      <h3 class="dash-card-title">Recent Workflow Activity</h3>
      <a href="" class="dash-card-link">View all &#x203A;</a>
    </div>
    <div class="log-list">
      {% if recent_logs %}
        {% for log in recent_logs %}
        <div class="log-row table-row-anim table-row-delay-{{ forloop.counter }}">
          <div class="log-icon">
            <svg width="13" height="13" viewBox="0 0 24 24" fill="none">
              <polyline points="22 12 18 12 15 21 9 3 6 12 2 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </div>
          <div class="log-body">
            <span class="log-article">{{ log.article.title|truncatechars:40 }}</span>
            <span class="log-transition">
              <span class="status-badge status-badge--{{ log.old_status }}">{{ log.old_status }}</span>
              <span class="log-arrow">&#x2192;</span>
              <span class="status-badge status-badge--{{ log.new_status }}">{{ log.new_status }}</span>
            </span>
          </div>
          <div class="log-meta">
            <span class="log-user">{{ log.changed_by.username|default:"system" }}</span>
            <span class="log-time">{{ log.changed_at|timesince }} ago</span>
          </div>
        </div>
        {% endfor %}
      {% else %}
        <p class="empty-table">No workflow activity yet.</p>
      {% endif %}
    </div>
  </div>
</div>

<!-- ══════════════════════════════════════════
     QUICK ACCESS — all registered models
══════════════════════════════════════════ -->
<section class="quick-access">
  <h3 class="quick-title">Quick Access</h3>
  <div class="quick-grid">
    {% for app in app_list %}
      {% for model in app.models %}
      <div class="quick-item-wrapper">
        <a href="{{ model.admin_url }}" class="quick-item">
          <span class="quick-icon">
            <svg width="15" height="15" viewBox="0 0 24 24" fill="none">
              <path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </span>
          <span class="quick-label">{{ model.name }}</span>
        </a>
        {% if model.add_url %}
        <a href="{{ model.add_url }}" class="quick-add" title="Add {{ model.name }}">+</a>
        {% endif %}
      </div>
      {% endfor %}
    {% endfor %}
  </div>
</section>

<!-- ══════════════════════════════════════════
     JAVASCRIPT — reads Django context vars
══════════════════════════════════════════ -->
<script>
document.addEventListener('DOMContentLoaded', function () {

  /* ── 1. Dates ──────────────────────────────────────────── */
  var now = new Date();

  function fmt(d) {
    return d.toLocaleDateString('en-US', {
      month: 'long',
      day: 'numeric',
      year: 'numeric'
    });
  }

  var ago = new Date(now);
  ago.setMonth(now.getMonth() - 3);

  var currentDateRangeEl = document.getElementById('currentDateRange');
  var liveDateEl = document.getElementById('liveDate');

  if (currentDateRangeEl) {
    currentDateRangeEl.textContent = fmt(ago) + ' – ' + fmt(now);
  }
  if (liveDateEl) {
    liveDateEl.textContent = fmt(now);
  }

  /* ── 2. Animated count-up ──────────────────────────────── */
  function animateCount(id, target) {
    var el = document.getElementById(id);
    if (!el) return;

    var start = 0;
    var step = Math.max(1, Math.ceil(target / 50));
    el.textContent = '0';

    var timer = setInterval(function () {
      start = Math.min(start + step, target);
      el.textContent = start.toLocaleString();
      if (start >= target) {
        clearInterval(timer);
      }
    }, 20);
  }

  animateCount(
    'totalArticles',
    parseInt('{{ total_articles|default:0 }}', 10) || 0
  );

  animateCount(
    'publishedArticles',
    parseInt('{{ published_articles|default:0 }}', 10) || 0
  );

  animateCount(
    'pipelineArticles',
    (parseInt('{{ review_articles|default:0 }}', 10) || 0) +
    (parseInt('{{ fact_check_articles|default:0 }}', 10) || 0)
  );

  /* ── 3. Category bar widths ────────────────────────────── */
  document.querySelectorAll('.cat-bar-fill').forEach(function (bar) {
    var width = parseFloat(bar.dataset.width) || 0;
    bar.style.width = width + '%';
  });

  /* ── 4. SAFE JSON DATA FROM DJANGO ────────────────────── */
  var monthlyLabels = JSON.parse('{{ monthly_labels_json|default:"[]"|escapejs }}');
  var monthlyPub    = JSON.parse('{{ monthly_pub_json|default:"[]"|escapejs }}');
  var monthlyDraft  = JSON.parse('{{ monthly_draft_json|default:"[]"|escapejs }}');
  var donutData     = JSON.parse('{{ donut_data_json|default:"[0,0,0,0,0,0]"|escapejs }}');

  if (!Array.isArray(monthlyLabels) || monthlyLabels.length === 0) {
    monthlyLabels = ['Sep','Oct','Nov','Dec','Jan','Feb','Mar','Apr','May','Jun','Jul','Aug'];
    monthlyPub    = [0,0,0,0,0,0,0,0,0,0,0,0];
    monthlyDraft  = [0,0,0,0,0,0,0,0,0,0,0,0];
  }

  /* ── 5. Bar Chart ─────────────────────────────────────── */
  var pubCanvas = document.getElementById('pubChart');

  if (pubCanvas) {
    new Chart(pubCanvas.getContext('2d'), {
      type: 'bar',
      data: {
        labels: monthlyLabels,
        datasets: [
          {
            label: 'Published',
            data: monthlyPub,
            backgroundColor: '#1a4731',
            borderRadius: 6,
            barPercentage: 0.6
          },
          {
            label: 'Drafts',
            data: monthlyDraft,
            backgroundColor: '#a8d5b5',
            borderRadius: 6,
            barPercentage: 0.6
          }
        ]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: { display: false }
        },
        scales: {
          x: {
            grid: { display: false },
            ticks: { color: '#999', font: { size: 10 } }
          },
          y: {
            beginAtZero: true,
            grid: { color: '#f0f0f0' },
            ticks: { stepSize: 1, color: '#999', font: { size: 10 } }
          }
        }
      }
    });
  }

  /* ── 6. Donut Chart ───────────────────────────────────── */
  var donutCanvas = document.getElementById('donutChart');

  if (donutCanvas) {
    new Chart(donutCanvas.getContext('2d'), {
      type: 'doughnut',
      data: {
        labels: ['Published', 'Draft', 'Review', 'Archived', 'Rejected', 'Other'],
        datasets: [{
          data: donutData,
          backgroundColor: [
            '#1a4731',
            '#4caf7d',
            '#f0a500',
            '#8fa899',
            '#e05252',
            '#a8d5b5'
          ],
          borderWidth: 0,
          hoverOffset: 6
        }]
      },
      options: {
        cutout: '72%',
        plugins: {
          legend: { display: false },
          tooltip: {
            callbacks: {
              label: function (ctx) {
                return ' ' + ctx.label + ': ' + ctx.raw;
              }
            }
          }
        },
        animation: {
          animateRotate: true,
          duration: 1000
        }
      }
    });
  }

});
</script>

{% endblock %}