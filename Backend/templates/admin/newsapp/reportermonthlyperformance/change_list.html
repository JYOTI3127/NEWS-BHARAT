{% extends "admin/change_list.html" %}
{% load i18n static %}

{% block extrahead %}
  {{ block.super }}
  <link rel="stylesheet" href="{% static 'admin/css/dashboard.css' %}">
{% endblock %}


{% block content %}

{% if top_performer %}
<div class="tp-card">
  <div class="tp-card__glow"></div>

  <div class="tp-card__label">ğŸ† Top Performer â€” {{ current_month }}</div>

  <div class="tp-card__body">

    <div class="tp-avatar">
      {{ top_performer.reporter.username|first|upper }}
    </div>

    <div class="tp-info">
      <div class="tp-info__name">{{ top_performer.reporter.username }}</div>
      <div class="tp-stats">
        <div>
          <div class="tp-stat__label">ğŸ“° Published</div>
          <div class="tp-stat__value tp-stat__value--green">{{ top_performer.articles_published }}</div>
        </div>
        <div>
          <div class="tp-stat__label">ğŸ‘ï¸ Avg Views</div>
          <div class="tp-stat__value">{{ top_performer.avg_views }}</div>
        </div>
        <div>
          <div class="tp-stat__label">ğŸ”¥ Engagement</div>
          <div class="tp-stat__value">{{ top_performer.avg_engagement_score }}</div>
        </div>
        <div>
          <div class="tp-stat__label">â° Deadline %</div>
          <div class="tp-stat__value">{{ top_performer.deadline_adherence_rate }}%</div>
        </div>
        <div>
          <div class="tp-stat__label">ğŸ“‹ Assigned</div>
          <div class="tp-stat__value">{{ top_performer.articles_assigned }}</div>
        </div>
        <div>
          <div class="tp-stat__label">âŒ Rejected</div>
          <div class="tp-stat__value">{{ top_performer.articles_rejected }}</div>
        </div>
      </div>
    </div>

    <div class="tp-score">
      <div class="tp-score__number">{{ top_performer.performance_score }}</div>
      <div class="tp-score__sub">out of 100</div>
    </div>

  </div>
</div>
{% endif %}


{% if ranked_reporters %}
<!-- RANKINGS TABLE -->
<div class="rank-wrap">
  <div class="rank-header">
    <span class="rank-header__title">All Reporters Ranking</span>
    <span class="rank-header__month">{{ current_month }}</span>
  </div>

  <div class="rank-scroll">
    <table class="rank-table">
      <thead>
        <tr>
          <th>#</th>
          <th>Reporter</th>
          <th>Assigned</th>
          <th>Submitted</th>
          <th>Published</th>
          <th>Rejected</th>
          <th>Rej %</th>
          <th>Deadline %</th>
          <th>Avg Views</th>
          <th>Engagement</th>
          <th>Plagiarism</th>
          <th>Score</th>
        </tr>
      </thead>
      <tbody>
        {% for p in ranked_reporters %}
        <tr>

          <!-- Rank -->
          <td class="td--rank">
            {% if forloop.counter == 1 %}ğŸ¥‡
            {% elif forloop.counter == 2 %}ğŸ¥ˆ
            {% elif forloop.counter == 3 %}ğŸ¥‰
            {% else %}#{{ forloop.counter }}
            {% endif %}
          </td>

          <!-- Reporter Name -->
          <td class="td--name">
            <div class="reporter-cell">
              <div class="reporter-cell__avatar">
                {{ p.reporter.username|first|upper }}
              </div>
              {{ p.reporter.username }}
            </div>
          </td>

          <td>{{ p.articles_assigned }}</td>
          <td>{{ p.articles_submitted }}</td>
          <td class="td--pub">{{ p.articles_published }}</td>
          <td class="td--rej">{{ p.articles_rejected }}</td>

          <!-- Rejection Rate badge -->
          <td>
            <span class="badge {% if p.rejection_rate > 15 %}badge--danger{% else %}badge--success{% endif %}">
              {{ p.rejection_rate }}%
            </span>
          </td>

          <td>{{ p.deadline_adherence_rate }}%</td>
          <td>{{ p.avg_views }}</td>
          <td>{{ p.avg_engagement_score }}</td>

          <!-- Plagiarism -->
          <td class="{% if p.plagiarism_avg_score > 3 %}txt--danger{% else %}txt--muted{% endif %}">
            {{ p.plagiarism_avg_score }}%
          </td>

          <!-- Score bar -->
          <td>
            <div class="score-cell">
              <div class="score-bar__track">
                <div class="score-bar__fill
                  {% if p.performance_score >= 85 %}score-bar__fill--high
                  {% elif p.performance_score >= 70 %}score-bar__fill--medium
                  {% else %}score-bar__fill--low{% endif %}"
                  style="width: {{ p.performance_score }}%">
                </div>
              </div>
              <span class="
                {% if p.performance_score >= 85 %}score-val--high
                {% elif p.performance_score >= 70 %}score-val--medium
                {% else %}score-val--low{% endif %}">
                {{ p.performance_score }}
              </span>
            </div>
          </td>

        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endif %}

{% endblock %}